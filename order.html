<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Order — YourBracelet</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body{font-family:Poppins, sans-serif;background:#f6f7fb;color:#111;margin:0;padding:20px;}
    .card{max-width:900px;margin:18px auto;background:#fff;border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(15,23,42,0.06)}
    h2{margin-bottom:8px}
    label{display:block;margin-top:10px;color:#4b5563;font-size:13px}
    input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #d1d5db;background:#fbfbfd;font-size:14px}
    .row{display:flex;gap:10px}
    .col{flex:1}
    .btn{display:inline-block;padding:10px 14px;border-radius:999px;border:none;cursor:pointer}
    .btn-primary{background:linear-gradient(135deg,#ec4899,#f97316);color:#fff}
    .note{color:#6b7280;font-size:13px;margin-top:10px}
    .preview{display:flex;gap:12px;align-items:center;margin-top:12px}
    .preview img{max-width:160px;border-radius:10px;border:1px solid #e5e7eb;object-fit:cover;height:120px}
    .preview .placeholder{width:160px;height:120px;border-radius:10px;border:1px dashed #e5e7eb;display:flex;align-items:center;justify-content:center;color:#9ca3af;background:#fff}
    .small-muted{font-size:12px;color:#6b7280}
  </style>
</head>
<body>
  <div class="card">
    <h2>Order Form — YourBracelet</h2>
    <div id="sourceShow" class="note">Source: —</div>

    <div class="preview" id="imgPreview" style="display:none">
      <img id="previewImg" src="" alt="Preview">
      <div class="note" id="imgLabel"></div>
    </div>

    <!-- Order form (same fields as main page) -->
    <form id="orderForm">
      <label>पूरा नाम*</label>
      <input id="name" required placeholder="जैसे — रोहन सोलंकी" />

      <label>मोबाइल नंबर (WhatsApp)*</label>
      <input id="phone" required placeholder="10 digit" maxlength="10" />

      <div class="row">
        <div class="col">
          <label>शहर*</label>
          <input id="city" required />
        </div>
        <div class="col">
          <label>स्टेट*</label>
          <input id="state" required />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>पिनकोड*</label>
          <input id="pincode" required maxlength="6" />
        </div>
        <div class="col">
          <label>क्वांटिटी*</label>
          <input id="quantity" type="number" value="1" min="1" />
        </div>
      </div>

      <label>पूरा पता*</label>
      <textarea id="address" required></textarea>

      <label>Extra Note (optional)</label>
      <textarea id="note"></textarea>

      <!-- Hidden field to store clicked source -->
      <input type="hidden" id="clickedSource" name="clickedSource" value="Direct / Not selected">

      <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;">
        <button type="button" id="payBtn" class="btn btn-primary">1️⃣ Proceed to Payment (QR नीचे)</button>
        <button type="button" id="sendWA" class="btn" style="border:1px solid #ec4899;color:#ec4899">2️⃣ I Paid — Send WhatsApp</button>
      </div>

      <p class="note">नोट: नीचे QR स्कैन करके Booking Charges (₹500) भेजें और स्क्रीनशॉट सेव रखें।</p>

      <div style="margin-top:12px">
        <div style="display:flex;gap:12px;align-items:center">
          <div style="width:180px;border-radius:12px;border:2px dashed #ec4899;padding:8px;text-align:center;background:#fff">
            <img src="qr.jpg" alt="QR" style="max-width:100%">
          </div>
          <div class="note">
            <strong>UPI ID:</strong> yourupi@bank<br>
            <strong>Amount:</strong> ₹500 (Booking)
          </div>
        </div>
      </div>
    </form>
  </div>

<script>
  // read query params
  const params = new URLSearchParams(location.search);
  const product = params.get('product') || 'Direct / Not selected';
  const imgParam = params.get('img') || '';

  // add a visible file input for gallery upload
  // we'll insert it dynamically at top of form, above name field
  (function addFileInput() {
    const form = document.getElementById('orderForm');
    const wrapper = document.createElement('div');
    wrapper.style.marginTop = '12px';

    // label + file input + helper text
    wrapper.innerHTML = `
      <label>अपनी फोटो अपलोड करें (गैलरी चुनें):</label>
      <input id="fileInput" type="file" accept="image/*" style="padding:10px;background:#fff;border-radius:8px" />
      <div class="small-muted">क्लियर फोटो चुनें। फोटो चुनते ही यहाँ प्रीव्यू दिखाई देगा।</div>
    `;
    // insert at the top of form
    form.insertBefore(wrapper, form.firstChild);

    // hook events after DOM ready
    initFileHandlers();
  })();

  // preview elements
  const previewContainer = document.getElementById('imgPreview');
  const previewImg = document.getElementById('previewImg');
  const imgLabel = document.getElementById('imgLabel');
  const clickedSourceInput = document.getElementById('clickedSource');

  function showPreviewFromURL(url, labelText) {
    if (!url) return;
    previewImg.src = url;
    previewImg.onload = () => {
      previewContainer.style.display = 'flex';
      imgLabel.textContent = labelText || 'Selected Photo';
    };
    previewImg.onerror = () => {
      // if remote URL fails, still show placeholder text
      previewContainer.style.display = 'flex';
      previewImg.style.display = 'none';
      imgLabel.textContent = (labelText || 'Selected Photo') + ' (image failed to load)';
    };
    // set clickedSource (store the URL)
    clickedSourceInput.value = (labelText || '') + (url ? ' | ' + url : '');
    // ensure previewImg visible (in case previous error hid it)
    previewImg.style.display = '';
  }

  function initFileHandlers() {
    const fileInput = document.getElementById('fileInput');

    // if query param img present, show it as preview
    if (imgParam) {
      showPreviewFromURL(imgParam, product);
      // also set clickedSource so order knows
      clickedSourceInput.value = product + ' | ' + imgParam;
    }

    // when user picks file from gallery
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      // only images allowed; validate basic size/type if needed
      if (!file.type.startsWith('image/')) {
        alert('कृपया केवल इमेज फ़ाइल चुनें।'); 
        fileInput.value = '';
        return;
      }
      // create object URL for fast preview
      const objectUrl = URL.createObjectURL(file);
      previewImg.src = objectUrl;
      previewImg.onload = () => {
        previewContainer.style.display = 'flex';
        imgLabel.textContent = file.name || 'Selected Photo';
        // store filename in clickedSource (we can't send actual file over wa.me)
        clickedSourceInput.value = 'Uploaded from gallery | ' + (file.name || 'selected-image');
        // revoke objectURL later to free memory
        setTimeout(() => URL.revokeObjectURL(objectUrl), 5000);
      };
      previewImg.onerror = () => {
        previewContainer.style.display = 'flex';
        previewImg.style.display = 'none';
        imgLabel.textContent = (file.name || 'Selected Photo') + ' (preview failed)';
      };
    });

    // also allow clicking preview area to open file picker
    previewContainer.addEventListener('click', () => {
      const fileInputEl = document.getElementById('fileInput');
      if (fileInputEl) fileInputEl.click();
    });

    // If preview area not visible yet, show placeholder clickable box under sourceShow
    const sourceShow = document.getElementById('sourceShow');
    if (!previewContainer.innerHTML.trim()) {
      // nothing - but we already created preview img element; ensure container is available
    }
  }

  // show source text
  document.getElementById('sourceShow').textContent = 'Source: ' + product;

  function getFormData() {
    return {
      name: document.getElementById('name').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      city: document.getElementById('city').value.trim(),
      state: document.getElementById('state').value.trim(),
      pincode: document.getElementById('pincode').value.trim(),
      quantity: document.getElementById('quantity').value,
      address: document.getElementById('address').value.trim(),
      note: document.getElementById('note').value.trim(),
      clickedFrom: document.getElementById('clickedSource').value
    };
  }

  function validate() {
    const f = getFormData();
    if (!f.name || !f.phone || !f.city || !f.state || !f.pincode || !f.address) {
      alert('कृपया सभी required फील्ड्स भरें।'); return false;
    }
    if (f.phone.length !== 10) { alert('कृपया 10 digit फोन नंबर डालें।'); return false; }
    if (f.pincode.length !== 6) { alert('6 digit पिनकोड भरें।'); return false; }
    return true;
  }

  // open payment section (scroll behavior is not needed since new page)
  document.getElementById('payBtn').addEventListener('click', () => {
    if (!validate()) return;
    // scroll to bottom where QR would be
    window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
  });

  // Send WhatsApp with details (user will attach screenshot/manual photo)
  document.getElementById('sendWA').addEventListener('click', () => {
    if (!validate()) return;
    const f = getFormData();
    // include clickedFrom which may contain uploaded filename or source URL
    const message = [
      "*New Bracelet Order*",
      "Name: " + f.name,
      "Phone: " + f.phone,
      "City/State: " + f.city + " / " + f.state,
      "Pincode: " + f.pincode,
      "Qty: " + f.quantity,
      "Address: " + f.address,
      "Note: " + (f.note || "-"),
      "Clicked From / Photo Source: " + (f.clickedFrom || "Direct"),
      "",
      "Payment: Booking Charges ₹500 (QR से भेजा / भेजूँगा). मैं स्क्रीनशॉट यहाँ attach कर रहा/करूँगा."
    ].join("%0A");

    const whatsappNumber = "916376662787";
    const url = "https://wa.me/" + whatsappNumber + "?text=" + encodeURIComponent(decodeURIComponent(message));
    window.open(url, "_blank");
  });
</script>
</body>
</html>
